<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>홈 화면에 추가</title>
    <script>
        // 브라우저가 PWA 기능을 지원하는지 확인합니다.
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js')
                .then(registration => {
                    console.log('Service Worker 등록 성공:', registration);
                })
                .catch(error => {
                    console.error('Service Worker 등록 실패:', error);
                });
        }

        // iOS인지 확인합니다.
        function isIOS() {
            return /iPad|iPhone|iPod/.test(navigator.userAgent)
                && !window.MSStream;
        }

        // iOS 홈 화면에 추가되었는지 확인합니다.
        function isIOSWebApp() {
            return ('standalone' in window.navigator) && (window.navigator.standalone);
        }

        // Android인지 확인합니다.
        function isAndroid() {
            return /android/i.test(navigator.userAgent);
        }

        // Android 홈 화면에 추가되었는지 확인합니다.
        function isAndroidWebApp() {
             return window.matchMedia('(display-mode: standalone)').matches;
        }

        window.onload = function() {
            const addToHomeScreenButton = document.getElementById('add-to-home-screen');
            const instructionsContainer = document.getElementById('instructions-container');
            const closeInstructionsButton = document.getElementById('close-instructions');
            let deferredPrompt;

            // PWA 설치 가능 여부 이벤트를 감지합니다.
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault(); // 브라우저의 기본 설치 프롬프트를 막습니다.
                deferredPrompt = e; // 나중에 사용할 수 있도록 저장해 둡니다.
                // 안드로이드이고, 웹앱이 아닌 경우에만 설치 버튼을 표시합니다.
                if (isAndroid() && !isAndroidWebApp()) {
                    addToHomeScreenButton.style.display = 'block';
                    addToHomeScreenButton.addEventListener('click', async () => {
                        if (deferredPrompt) {
                            deferredPrompt.prompt(); // 설치 프롬프트를 표시합니다.
                            const choiceResult = await deferredPrompt.userChoice; // 사용자의 선택을 기다립니다.
                            if (choiceResult.outcome === 'accepted') {
                                console.log('사용자가 설치를 수락했습니다.');
                                addToHomeScreenButton.style.display = 'none'; // 설치 후 버튼을 숨깁니다.
                            } else {
                                console.log('사용자가 설치를 거부했습니다.');
                            }
                            deferredPrompt = null; // deferredPrompt를 초기화합니다.
                        }
                    });
                }
                // iOS일 경우 홈 화면에 추가 안내를 표시합니다.
                if (isIOS() && !isIOSWebApp()) {
                    instructionsContainer.style.display = 'block';
                }
            });

            // iOS 홈 화면 추가 안내 닫기 버튼
            if (closeInstructionsButton) { // 버튼이 존재하는지 확인
                closeInstructionsButton.addEventListener('click', () => {
                    instructionsContainer.style.display = 'none';
                });
            }
        };
    </script>
    <style>
      #add-to-home-screen {
        display: none; /* PWA 설치 가능한 경우에만 표시되도록 변경 */
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background-color: #4CAF50;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        z-index: 1000;
      }

      #add-to-home-screen:hover {
        background-color: #367c39;
      }

      #instructions-container {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        z-index: 1000;
        width: 80%;
        max-width: 500px;
      }

      #instructions-container p {
        margin-bottom: 15px;
        font-size: 16px;
      }

      #instructions-container ol {
        list-style-position: inside;
        margin-bottom: 15px;
        font-size: 16px;
      }

      #instructions-container img {
        max-width: 100%;
        height: auto;
        margin-bottom: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }

      #close-instructions {
        background-color: #f44336;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        margin-top: 10px;
        border-radius: 5px;
      }

      #close-instructions:hover {
        background-color: #d32f2f;
      }

      @media (max-width: 600px) {
        #instructions-container {
          width: 95%;
        }
      }
    </style>
</head>
<body>
    <button id="add-to-home-screen">홈 화면에 추가</button>

    <div id="instructions-container">
        <p>홈 화면에 추가하려면 다음 단계를 따르세요:</p>
        <ol>
            <li>하단에 있는 공유 아이콘(
                <img src="https://support.apple.com/library/content/dam/edam/applecare/images/en_US/ios/share-icon-ios-17_2x.png" alt="공유 아이콘" width="20" height="20">
                )을 탭하세요.
            </li>
            <li>"홈 화면에 추가"를 탭하세요.</li>
            <li>오른쪽 상단의 "추가"를 탭하세요.</li>
        </ol>
        <button id="close-instructions">닫기</button>
    </div>

    <h1>내 웹사이트</h1>
    <p>이것은 PWA 예제입니다. 홈 화면에 추가하여 앱처럼 사용할 수 있습니다.</p>

    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/service-worker.js', {
          scope: '/'
        }).then(function(registration) {
          console.log('Service Worker 등록 성공. Scope: ', registration.scope);
        }).catch(function(error) {
          console.log('Service Worker 등록 실패', error);
        });
      }
    </script>
</body>
</html>
